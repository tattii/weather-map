(this.webpackJsonpweatherbox=this.webpackJsonpweatherbox||[]).push([[0],{115:function(t,e,a){t.exports=a(245)},120:function(t,e,a){},122:function(t,e,a){},124:function(t,e,a){},245:function(t,e,a){"use strict";a.r(e);var s=a(0),r=a.n(s),o=a(23),i=a.n(o),n=(a(120),a(30)),d=a.n(n);a(121);class p{constructor(t){this.map=t,this.map.addSource("vt",{type:"vector",minzoom:0,maxzoom:10,tiles:["https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"pref-line",type:"line",source:"vt","source-layer":"pref",paint:{"line-color":"rgba(70, 70, 70, 0.4)"}})}}a(122);var h=a(32),l=a.n(h),c=a(65),m=a(45);class u{constructor(t,e){this.map=t,this.add(e)}add(t){this.map.addSource("weathermap-front",{type:"geojson",data:this.source(t)}),this.addLayer()}set(t){this.map.getSource("weathermap-front").setData(this.source(t))}source(t){const e=t.features.filter(t=>t.properties.type&&t.properties.type.includes("\u524d\u7dda")).reduce((t,e)=>t.concat(this.split(e).features),[]);return m.featureCollection(e)}split(t){const e="\u505c\u6ede\u524d\u7dda"===t.properties.type?450:360,a=m.lineChunk(t,e);for(let s in a.features)a.features[s].properties=Object.assign({},t.properties),m.length(a.features[s])<100&&(a.features[s].properties.z=10);return a}addLayer(){this.addFront("cold","\u5bd2\u51b7\u524d\u7dda",-8),this.addFront("warm","\u6e29\u6696\u524d\u7dda",5),this.addFront("stationary","\u505c\u6ede\u524d\u7dda",-3),this.addFront("occuluded","\u9589\u585e\u524d\u7dda",7)}addFront(t,e,a,s){this.map.addLayer({id:"front-symbol-"+t,type:"symbol",source:"weathermap-front",minzoom:3,layout:{"icon-image":"front2-"+t,"icon-size":["interpolate",["exponential",1],["zoom"],3,.6,8,1.6],"symbol-placement":"line-center","symbol-spacing":100,"icon-offset":[0,a],"icon-rotate":180},filter:["all",["==","type",e],["!=","z",10]]})}}var y=a(31),f=a.n(y);class w{constructor(t){this.map=t,this.add(),this.show=null}add(){fetch("https://dkve47d2tju8b.cloudfront.net/omaad/rsmc_nowcast/en/jmatile/data/hcai/targetTimes.json",{mode:"cors"}).then(t=>t.json()).then(t=>{console.log(t),this.data=t,this.show=t.length-1,this.addLayer(t[this.show])})}hide(t){const e="sat-"+this.data[t||this.show].validtime;this.map.getLayer(e)&&this.map.removeLayer(e),this.map.getSource(e)&&this.map.removeSource(e)}set(t){if(!this.data)return;const e=this.data.findIndex(e=>f()(t)-f.a.utc(e.validtime,"YYYYMMDDHHdd")===0);console.log(e),e<0?this.hide():(this.addLayer(this.data[e]),this.hide(this.show),this.show=e)}addLayer(t){const e="https://www.data.jma.go.jp/tile/satimg/"+t.basetime+"/fd/"+t.validtime+"/B13/TBB/{z}/{x}/{y}.png",a="sat-"+t.validtime;this.map.addSource(a,{type:"raster",tiles:[e],minzoom:1,maxzoom:6}),this.map.addLayer({id:a,type:"raster",source:a,paint:{"raster-opacity":.3}},"isobar-2hPa")}addLayerJP(t){const e="https://www.data.jma.go.jp/tile/satprod/"+t.basetime+"/JP/"+t.validtime+"/B13/TBB/{z}/{x}/{y}.png";this.map.addSource("satellite",{type:"raster",tiles:[e],minzoom:3,maxzoom:7,bouds:[119,19,155,51]})}}class b{constructor(t,e){this.hover=t=>{const e=this.map.queryRenderedFeatures(t.point,{layers:[this.layerId]});let a;if(this.map.getCanvas().style.cursor=e.length?"crosshair":"",e.length){a=e[0].properties.code}a?this.popup.setLngLat(t.lngLat).setHTML(a).addTo(this.map):this.popup.remove()},this.map=t,this.data=e,this.layerId="weather-map",this.sourceId="weathermap",this.addMap()}addMap(){this.addLayer(this.data.analysis[0].url),this.popup=new d.a.Popup({closeButton:!1})}remove(){this.map.removeLayer(this.layerId),this.map.off("mousemove",this.hover),this.popup.remove()}set(t,e,a){this.addLayer(e),"forecast"===a?this.satellite.hide():this.satellite.set(t)}addLayer(t){var e=this;return Object(c.a)(l.a.mark((function a(){var s,r;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.fetchGeojson(t);case 2:s=a.sent,(r=e.map.getSource(e.sourceId))?(r.setData(s),e.front.set(s),e.setTyphoon(s)):(e.map.addSource(e.sourceId,{type:"geojson",data:s}),e.addLayers(s),e.satellite=new w(e.map));case 5:case"end":return a.stop()}}),a)})))()}fetchGeojson(t){return Object(c.a)(l.a.mark((function e(){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:return a=e.sent,e.next=5,a.json();case 5:return(s=e.sent).features.forEach((t,e)=>{"isobar"===t.properties.type&&(t.properties.pressure%20===0?s.features[e].properties.isobar="20hPa":t.properties.pressure%4===0?s.features[e].properties.isobar="4hPa":t.properties.pressure%2===0&&(s.features[e].properties.isobar="2hPa"))}),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))()}addLayers(t){this.addIsobar("2hPa",.75,[10,5]),this.addIsobar("4hPa",.75),this.addIsobar("20hPa",1.5),this.front=new u(this.map,t),this.map.addLayer({id:"front",type:"line",source:"weathermap",paint:{"line-width":4,"line-color":["match",["get","type"],"\u5bd2\u51b7\u524d\u7dda","#1437B1","\u6e29\u6696\u524d\u7dda","#7A1C1C","\u505c\u6ede\u524d\u7dda","#39144C","\u9589\u585e\u524d\u7dda","#39144C","#000"]},filter:["in","type","\u5bd2\u51b7\u524d\u7dda","\u6e29\u6696\u524d\u7dda","\u505c\u6ede\u524d\u7dda","\u9589\u585e\u524d\u7dda"]}),this.addSymbols(),this.addTyphoons(t)}addIsobar(t,e,a){const s={"line-color":"#ccc","line-opacity":.3,"line-width":e};a&&(s["line-dasharray"]=a),this.map.addLayer({id:"isobar-"+t,type:"line",source:"weathermap",paint:s,filter:["all",["==","type","isobar"],["==","isobar",t]]})}addSymbols(){this.map.addLayer({id:"symbol",type:"symbol",source:"weathermap",layout:{"icon-image":"center","icon-size":.6,"icon-allow-overlap":!0},paint:{"icon-opacity":.7},filter:["in","type","\u4f4e\u6c17\u5727","\u9ad8\u6c17\u5727","\u71b1\u5e2f\u4f4e\u6c17\u5727"]}),this.map.addLayer({id:"symbol-pressure",type:"symbol",source:"weathermap",minzoom:3,layout:{"text-field":"{pressure}","text-size":12,"text-font":["DIN Pro Regular"],"text-offset":[0,1.4]},paint:{"text-color":"rgba(255, 255, 255, 0.8)"},filter:["in","type","\u4f4e\u6c17\u5727","\u9ad8\u6c17\u5727","\u71b1\u5e2f\u4f4e\u6c17\u5727"]}),this.addLabel("\u4f4e\u6c17\u5727","L","#7A1C1C"),this.addLabel("\u9ad8\u6c17\u5727","H","#1437B1"),this.addLabel("\u71b1\u5e2f\u4f4e\u6c17\u5727","TD","#7A1C1C")}addLabel(t,e,a){this.map.addLayer({id:"symbol-"+e,type:"symbol",source:"weathermap",layout:{"text-field":e,"text-size":20,"text-font":["DIN Pro Bold"],"text-offset":[0,-1]},paint:{"text-color":a,"text-halo-color":"rgba(255, 255, 255, 0.4)","text-halo-width":1},filter:["==","type",t]})}addTyphoons(t){this.map.addSource("weathermap-ty",{type:"geojson",data:this.typhoonGeojson(t)}),this.map.addLayer({id:"symbol-ty-pressure",type:"symbol",source:"weathermap-ty",minzoom:3,layout:{"text-field":"{pressure}","text-allow-overlap":!0,"text-size":12,"text-font":["DIN Pro Regular"],"text-offset":[-1.6,2.2]},paint:{"text-color":"rgba(255, 255, 255, 0.8)"}}),this.map.addLayer({id:"symbol-ty",type:"symbol",source:"weathermap-ty",layout:{"icon-image":"center","icon-size":.6,"icon-allow-overlap":!0,"text-field":"{name}","text-size":12,"text-font":["Noto Sans CJK JP Regular"],"text-offset":[-1.5,1]},paint:{"icon-opacity":.7,"text-color":"rgba(255, 255, 255, 0.8)"}})}setTyphoon(t){this.map.getSource("weathermap-ty").setData(this.typhoonGeojson(t))}typhoonGeojson(t){return{type:"FeatureCollection",features:t.features.filter(t=>"typhoonClass"in t.properties).map(t=>(t.properties.pressure=t.properties.center.pressure,t.properties.name="\u53f0"+parseInt(t.properties.name.number.substr(2))+"\u53f7",t))}}}var x=a(250);a(124);class g extends s.Component{constructor(...t){super(...t),this.state={index:null,datetime:null},this.back=()=>{const t=Math.max(0,this.state.index-1);this.set(t)},this.forward=()=>{const t=Math.min(this.list.length-1,this.state.index+1);this.set(t)}}componentDidMount(){this.listener=window.addEventListener("keydown",t=>"ArrowLeft"===t.key?(this.back(),null):"ArrowRight"===t.key?(this.forward(),null):void 0)}componentWillUnmount(){window.removeEventListener("keydown",this.listener)}componentDidUpdate(t){if(this.props.data!==t.data){const t=this.props.data,e=[t.forecast["24h"],t.forecast["48h"]].map(t=>(t.type="forecast",t));this.list=t.analysis.slice().reverse().concat(e);const a=this.datetime_str(t.analysis[0].datetime);this.setState({index:t.analysis.length-1,datetime:a})}}render(){return r.a.createElement(x.a.Group,{className:"time-button"},r.a.createElement(x.a,{icon:"left chevron",inverted:!0,onClick:this.back}),r.a.createElement(x.a,{content:this.state.datetime,inverted:!0,disabled:!0}),r.a.createElement(x.a,{icon:"right chevron",inverted:!0,onClick:this.forward}))}set(t){const e=this.list[t];let a=this.datetime_str(e.datetime);"forecast"===e.type&&(a+="(\u4e88\u60f3)"),this.setState({index:t,datetime:a}),this.props.select(e.datetime,e.url,e.type)}datetime_str(t){return f()(t).format("MM/DD HH:mm")}}class v extends s.Component{constructor(...t){super(...t),this.state={data:null},this.select=(t,e,a)=>{this.layer.set(t,e,a)}}componentDidMount(){this.map=this.props.map,this.load()}componentWillUnmount(){this.layer.remove()}onload(t){this.map=t,this.addLayer()}load(){const t=(new Date).getTime();fetch("https://storage.googleapis.com/weather-map/weather-map.json?"+t,{mode:"cors"}).then(t=>t.json()).then(t=>{console.log(t),this.setState({data:t}),this.data=t,this.addLayer()})}addLayer(){this.map&&this.data&&(this.layer=new b(this.map,this.data))}render(){return r.a.createElement(g,{data:this.state.data,select:this.select})}}d.a.accessToken="pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw";const L=[{id:"weather-map",component:v,name:"\u5929\u6c17\u56f3",icon:"warning sign"}];class z extends s.Component{constructor(...t){super(...t),this.state={layerIndex:0},this.selectLayer=t=>{this.setState({layerIndex:t})}}componentDidMount(){this.map=new d.a.Map({container:this.mapContainer,style:"mapbox://styles/tattii/ckc0b6ks64uks1io9nljrkbhs",zoom:4.2,center:[136.6,35.5],hash:!0,logoPosition:"bottom-right",attributionControl:!1,fadeDuration:0}),this.map.on("load",()=>{this.base=new p(this.map),this.child.onload(this.map)})}render(){return r.a.createElement("div",{className:"app"},r.a.createElement("div",{ref:t=>this.mapContainer=t,id:"map"}),this.renderLayer())}renderLayer(){const t={map:this.map,ref:t=>this.child=t};return r.a.createElement(L[this.state.layerIndex].component,t)}}class I extends s.Component{render(){return r.a.createElement(z,null)}}var j=I;i.a.render(r.a.createElement(j,null),document.getElementById("app"))}},[[115,1,2]]]);
//# sourceMappingURL=main.b74918e7.chunk.js.map