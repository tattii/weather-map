(this.webpackJsonpweatherbox=this.webpackJsonpweatherbox||[]).push([[0],{12:function(e,t,a){},14:function(e,t,a){},16:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),o=a(5),i=a.n(o),n=(a(12),a(1)),p=a.n(n);a(13);class d{constructor(e){this.map=e,this.map.addSource("vt",{type:"vector",minzoom:0,maxzoom:10,tiles:["https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"pref-line",type:"line",source:"vt","source-layer":"pref",paint:{"line-color":"rgba(70, 70, 70, 0.4)"}})}}a(14);var l=a(3),h=a.n(l),c=a(6),m=a(2);class y{constructor(e,t){this.map=e,this.add(t)}add(e){const t=e.features.filter(e=>e.properties.type&&e.properties.type.includes("\u524d\u7dda")).reduce((e,t)=>e.concat(this.split(t).features),[]);this.map.addSource("weathermap-front",{type:"geojson",data:m.featureCollection(t)}),this.addLayer()}split(e){const t="\u505c\u6ede\u524d\u7dda"===e.properties.type?450:360,a=m.lineChunk(e,t);for(let s in a.features)a.features[s].properties=Object.assign({},e.properties),m.length(a.features[s])<100&&(a.features[s].properties.z=10);return a}addLayer(){this.addFront("cold","\u5bd2\u51b7\u524d\u7dda",-8),this.addFront("warm","\u6e29\u6696\u524d\u7dda",5),this.addFront("stationary","\u505c\u6ede\u524d\u7dda",-3),this.addFront("occuluded","\u9589\u585e\u524d\u7dda",7)}addFront(e,t,a,s){this.map.addLayer({id:"front-symbol-"+e,type:"symbol",source:"weathermap-front",minzoom:3,layout:{"icon-image":"front2-"+e,"icon-size":["interpolate",["exponential",1],["zoom"],3,.6,8,1.6],"symbol-placement":"line-center","symbol-spacing":100,"icon-offset":[0,a],"icon-rotate":180},filter:["all",["==","type",t],["!=","z",10]]})}}class u{constructor(e){this.map=e,this.add()}add(){fetch("https://dkve47d2tju8b.cloudfront.net/omaad/rsmc_nowcast/en/jmatile/data/hcai/targetTimes.json",{mode:"cors"}).then(e=>(console.log(e),e.json())).then(e=>{this.index=e,this.addLayer(e[e.length-1])})}addLayer(e){const t="https://www.data.jma.go.jp/tile/satimg/"+e.basetime+"/fd/"+e.validtime+"/B13/TBB/{z}/{x}/{y}.png";this.map.addSource("satellite",{type:"raster",tiles:[t],minzoom:1,maxzoom:6}),this.map.addLayer({id:"satellite",type:"raster",source:"satellite",paint:{"raster-opacity":.3}},"isobar-2hPa")}addLayerJP(e){const t="https://www.data.jma.go.jp/tile/satprod/"+e.basetime+"/JP/"+e.validtime+"/B13/TBB/{z}/{x}/{y}.png";this.map.addSource("satellite",{type:"raster",tiles:[t],minzoom:3,maxzoom:7,bouds:[119,19,155,51]})}}class f{constructor(e,t,a){this.hover=e=>{const t=this.map.queryRenderedFeatures(e.point,{layers:[this.layerId]});let a;if(this.map.getCanvas().style.cursor=t.length?"crosshair":"",t.length){a=t[0].properties.code}a?this.popup.setLngLat(e.lngLat).setHTML(a).addTo(this.map):this.popup.remove()},this.map=e,this.data=t,this.onSelected=a,this.layerId="weather-map",this.addMap()}addMap(){this.render(),this.addLayer(this.data.analysis[0].url),this.popup=new p.a.Popup({closeButton:!1})}remove(){this.map.removeLayer(this.layerId),this.map.off("mousemove",this.hover),this.popup.remove()}render(){}addLayer(e){var t=this;return Object(c.a)(h.a.mark((function a(){var s,r;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(e,{mode:"cors"});case 2:return s=a.sent,a.next=5,s.json();case 5:(r=a.sent).features.forEach((e,t)=>{"isobar"===e.properties.type&&(e.properties.pressure%20===0?r.features[t].properties.isobar="20hPa":e.properties.pressure%4===0?r.features[t].properties.isobar="4hPa":e.properties.pressure%2===0&&(r.features[t].properties.isobar="2hPa"))}),t.map.addSource("weathermap",{type:"geojson",data:r}),t.addIsobar("2hPa",.75,[10,5]),t.addIsobar("4hPa",.75),t.addIsobar("20hPa",1.5),t.front=new y(t.map,r),t.map.addLayer({id:"front",type:"line",source:"weathermap",paint:{"line-width":4,"line-color":["match",["get","type"],"\u5bd2\u51b7\u524d\u7dda","#1437B1","\u6e29\u6696\u524d\u7dda","#7A1C1C","\u505c\u6ede\u524d\u7dda","#39144C","\u9589\u585e\u524d\u7dda","#39144C","#000"]},filter:["in","type","\u5bd2\u51b7\u524d\u7dda","\u6e29\u6696\u524d\u7dda","\u505c\u6ede\u524d\u7dda","\u9589\u585e\u524d\u7dda"]}),t.addSymbols(),t.addTyphoons(r),t.satellit=new u(t.map);case 16:case"end":return a.stop()}}),a)})))()}addIsobar(e,t,a){const s={"line-color":"#ccc","line-opacity":.3,"line-width":t};a&&(s["line-dasharray"]=a),this.map.addLayer({id:"isobar-"+e,type:"line",source:"weathermap",paint:s,filter:["all",["==","type","isobar"],["==","isobar",e]]})}addSymbols(){this.map.addLayer({id:"symbol",type:"symbol",source:"weathermap",layout:{"icon-image":"center","icon-size":.6,"icon-allow-overlap":!0},paint:{"icon-opacity":.7},filter:["in","type","\u4f4e\u6c17\u5727","\u9ad8\u6c17\u5727","\u71b1\u5e2f\u4f4e\u6c17\u5727"]}),this.map.addLayer({id:"symbol-pressure",type:"symbol",source:"weathermap",minzoom:3,layout:{"text-field":"{pressure}","text-size":12,"text-font":["DIN Pro Regular"],"text-offset":[0,1.4]},paint:{"text-color":"rgba(255, 255, 255, 0.8)"},filter:["in","type","\u4f4e\u6c17\u5727","\u9ad8\u6c17\u5727","\u71b1\u5e2f\u4f4e\u6c17\u5727"]}),this.addLabel("\u4f4e\u6c17\u5727","L","#7A1C1C"),this.addLabel("\u9ad8\u6c17\u5727","H","#1437B1"),this.addLabel("\u71b1\u5e2f\u4f4e\u6c17\u5727","TD","#7A1C1C")}addLabel(e,t,a){this.map.addLayer({id:"symbol-"+t,type:"symbol",source:"weathermap",layout:{"text-field":t,"text-size":20,"text-font":["DIN Pro Bold"],"text-offset":[0,-1]},paint:{"text-color":a,"text-halo-color":"rgba(255, 255, 255, 0.4)","text-halo-width":1},filter:["==","type",e]})}addTyphoons(e){const t=e.features.filter(e=>"typhoonClass"in e.properties).map(e=>(e.properties.pressure=e.properties.center.pressure,e.properties.name="\u53f0"+parseInt(e.properties.name.number.substr(2))+"\u53f7",e));this.map.addSource("weathermap-ty",{type:"geojson",data:{type:"FeatureCollection",features:t}}),this.map.addLayer({id:"symbol-ty-pressure",type:"symbol",source:"weathermap-ty",minzoom:3,layout:{"text-field":"{pressure}","text-allow-overlap":!0,"text-size":12,"text-font":["DIN Pro Regular"],"text-offset":[-1.6,2.2]},paint:{"text-color":"rgba(255, 255, 255, 0.8)"}}),this.map.addLayer({id:"symbol-ty",type:"symbol",source:"weathermap-ty",layout:{"icon-image":"center","icon-size":.6,"icon-allow-overlap":!0,"text-field":"{name}","text-size":12,"text-font":["Noto Sans CJK JP Regular"],"text-offset":[-1.5,1]},paint:{"icon-opacity":.7,"text-color":"rgba(255, 255, 255, 0.8)"}})}}class b extends s.Component{constructor(...e){super(...e),this.state={data:null}}componentDidMount(){this.map=this.props.map,this.load()}componentWillUnmount(){this.layer.remove()}onload(e){this.map=e,this.addLayer()}load(){const e=(new Date).getTime();fetch("https://storage.googleapis.com/weather-map/weather-map.json?"+e,{mode:"cors"}).then(e=>e.json()).then(e=>{console.log(e),this.setState({data:e}),this.data=e,this.addLayer()})}addLayer(){this.map&&this.data&&(this.layer=new f(this.map,this.data,this.onSelected))}render(){return null}}p.a.accessToken="pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw";const w=[{id:"weather-map",component:b,name:"\u5929\u6c17\u56f3",icon:"warning sign"}];class x extends s.Component{constructor(...e){super(...e),this.state={layerIndex:0},this.selectLayer=e=>{this.setState({layerIndex:e})}}componentDidMount(){this.map=new p.a.Map({container:this.mapContainer,style:"mapbox://styles/tattii/ckc0b6ks64uks1io9nljrkbhs",zoom:4.2,center:[136.6,35.5],hash:!0,logoPosition:"bottom-right",attributionControl:!1}),this.map.on("load",()=>{this.base=new d(this.map),this.child.onload(this.map)})}render(){return r.a.createElement("div",{className:"app"},r.a.createElement("div",{ref:e=>this.mapContainer=e,id:"map"}),this.renderLayer())}renderLayer(){const e={map:this.map,ref:e=>this.child=e};return r.a.createElement(w[this.state.layerIndex].component,e)}}class g extends s.Component{render(){return r.a.createElement(x,null)}}var L=g;i.a.render(r.a.createElement(L,null),document.getElementById("app"))},7:function(e,t,a){e.exports=a(16)}},[[7,1,2]]]);
//# sourceMappingURL=main.35772e9c.chunk.js.map