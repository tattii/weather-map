{"version":3,"sources":["BaseLayer.js","weather-map-front.js","satellite.js","weather-map-layer.js","WeatherMap.js","Map.js","App.js","index.js"],"names":["BaseLayer","constructor","map","this","addSource","addLayer","WeatherMapFront","geojson","add","split","features","filter","f","properties","type","includes","reduce","concat","data","turf","segment","chunks","i","Object","assign","z","addFront","id","offset","width","Satellite","fetch","mode","then","res","console","log","json","index","length","d","url","basetime","validtime","tiles","minzoom","maxzoom","addLayerJP","bouds","WeatherMapLayer","onSelected","hover","e","queryRenderedFeatures","point","layers","layerId","html","getCanvas","style","cursor","code","popup","setLngLat","lngLat","setHTML","addTo","remove","addMap","render","analysis","mapboxgl","Popup","closeButton","removeLayer","off","forEach","pressure","isobar","addIsobar","front","addSymbols","addTyphoons","satellit","dash","paint","addLabel","label","color","typhoon","center","name","parseInt","number","substr","Warning","Component","state","componentDidMount","props","load","componentWillUnmount","layer","onload","timestamp","Date","getTime","setState","accessToken","component","WeatherMap","icon","Map","layerIndex","selectLayer","container","mapContainer","zoom","hash","logoPosition","attributionControl","on","base","child","className","ref","el","renderLayer","React","createElement","App","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.35772e9c.chunk.js","sourcesContent":["\nexport default class BaseLayer {\n  constructor(map) {\n    this.map = map;\n    this.map.addSource(\"vt\", {\n      \"type\": \"vector\",\n      \"minzoom\": 0,\n      \"maxzoom\": 10,\n      \"tiles\": [\"https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf\"]\n    });\n\n    this.map.addLayer({\n      \"id\": \"pref-line\",\n      \"type\": \"line\",\n      \"source\": \"vt\",\n      \"source-layer\": \"pref\",\n      \"paint\": {\n        \"line-color\": \"rgba(70, 70, 70, 0.4)\"\n      }\n    });\n  }\n}\n","import * as turf from '@turf/turf';\n\nexport default class WeatherMapFront {\n  constructor(map, geojson) {\n    this.map = map;\n    this.add(geojson);\n  }\n\n  add(geojson) {\n    const front = geojson.features.filter(f => f.properties.type && f.properties.type.includes('前線'));\n    const split = front.reduce((features, f) => {\n      return features.concat(this.split(f).features);\n    }, []);\n    \n    this.map.addSource('weathermap-front', {\n      type: 'geojson',\n      data: turf.featureCollection(split)\n    });\n    this.addLayer();\n  }\n\n  split(f) {\n    const segment = f.properties.type === '停滞前線' ? 450 : 360; // km\n    const chunks = turf.lineChunk(f, segment);\n    for (let i in chunks.features) {\n      chunks.features[i].properties = Object.assign({}, f.properties);\n      if (turf.length(chunks.features[i]) < 100) {\n        chunks.features[i].properties.z = 10;\n      }\n    }\n    return chunks;\n  }\n\n  addLayer() {\n    this.addFront('cold', '寒冷前線', -8);\n    this.addFront('warm', '温暖前線', 5);\n    this.addFront('stationary', '停滞前線', -3);\n    this.addFront('occuluded', '閉塞前線', 7);\n  }\n  \n  addFront(id, type, offset, width) {\n    this.map.addLayer({\n      \"id\": \"front-symbol-\" + id,\n      \"type\": \"symbol\",\n      \"source\": \"weathermap-front\",\n      \"minzoom\": 3.0,\n      \"layout\": {\n        \"icon-image\": \"front2-\" + id,\n        \"icon-size\": [\n          'interpolate',\n          ['exponential', 1.0],\n          ['zoom'],\n          3, 0.6,\n          8, 1.6\n        ],\n        \"symbol-placement\": \"line-center\",\n        \"symbol-spacing\": 100,\n        \"icon-offset\": [0, offset],\n        \"icon-rotate\": 180,\n      },\n      \"filter\": [\"all\",\n        [\"==\", \"type\", type],\n        [\"!=\", \"z\", 10]\n      ]\n    });\n  }\n}\n","export default class Satellite {\n  constructor(map) {\n    this.map = map;\n    this.add();\n  }\n\n  add() {\n    fetch('https://dkve47d2tju8b.cloudfront.net/omaad/rsmc_nowcast/en/jmatile/data/hcai/targetTimes.json', { mode: 'cors' })\n      .then(res => { console.log(res); return res.json(); })\n      .then(data => {\n        this.index = data;\n        this.addLayer(data[data.length - 1]);\n      });\n  }\n\n  \n  addLayer(d) {\n    const url = 'https://www.data.jma.go.jp/tile/satimg/' + d.basetime + '/fd/' + d.validtime + '/B13/TBB/{z}/{x}/{y}.png';\n    this.map.addSource('satellite', {\n      type: 'raster',\n      tiles: [url],\n      minzoom: 1,\n      maxzoom: 6,\n      //bouds: [119, 19, 155, 51]\n    });\n\n   this. map.addLayer({\n      \"id\": \"satellite\",\n      \"type\": \"raster\",\n      \"source\": \"satellite\",\n      \"paint\": {\n        \"raster-opacity\": 0.3\n      }\n    }, \"isobar-2hPa\");\n  }\n  \n  addLayerJP(d) {\n    const url = 'https://www.data.jma.go.jp/tile/satprod/' + d.basetime + '/JP/' + d.validtime + '/B13/TBB/{z}/{x}/{y}.png';\n    this.map.addSource('satellite', {\n      type: 'raster',\n      tiles: [url],\n      minzoom: 3,\n      maxzoom: 7,\n      bouds: [119, 19, 155, 51]\n    });\n  }\n}\n","import mapboxgl from 'mapbox-gl';\n\nimport WeatherMapFront from './weather-map-front';\nimport Satellite from './satellite';\n\nexport default class WeatherMapLayer {\n  constructor(map, data, onSelected) {\n    this.map = map;\n    this.data = data;\n    this.onSelected = onSelected;\n    this.layerId = 'weather-map';\n\n    this.addMap();\n  }\n\n  addMap() {\n    this.render();\n    this.addLayer(this.data.analysis[0].url);\n    //this.addLayer('https://storage.googleapis.com/weather-map/analysis/202006280000.geojson');\n\n    this.popup = new mapboxgl.Popup({\n      closeButton: false\n    });\n    //this.map.on('mousemove', this.hover);\n  }\n\n  remove() {\n    this.map.removeLayer(this.layerId);\n    this.map.off('mousemove', this.hover);\n    this.popup.remove();\n  }\n\n  render() {\n  }\n  \n  async addLayer(url) {\n    const res = await fetch(url, { mode: 'cors' });\n    const geojson = await res.json();\n    //console.log(geojson);\n\n    geojson.features.forEach((f, i) => {\n      if (f.properties.type === 'isobar') {\n        if (f.properties.pressure % 20 === 0) {\n          geojson.features[i].properties.isobar = '20hPa';\n        } else if (f.properties.pressure % 4 === 0) {\n          geojson.features[i].properties.isobar = '4hPa';\n        } else if (f.properties.pressure % 2 === 0) {\n          geojson.features[i].properties.isobar = '2hPa';\n        }\n      }\n    });\n    this.map.addSource('weathermap', {\n      type: 'geojson',\n      data: geojson\n    });\n\n    this.addIsobar('2hPa', 0.75, [10, 5]);\n    this.addIsobar('4hPa', 0.75);\n    this.addIsobar('20hPa', 1.5);\n\n    \n    this.front = new WeatherMapFront(this.map, geojson);\n    this.map.addLayer({\n      \"id\": \"front\",\n      \"type\": \"line\",\n      \"source\": \"weathermap\",\n      \"paint\": {\n        \"line-width\": 4,\n        \"line-color\": [\n          \"match\",\n          [\"get\", \"type\"],\n          \"寒冷前線\", \"#1437B1\",\n          \"温暖前線\", \"#7A1C1C\",\n          \"停滞前線\", \"#39144C\",\n          \"閉塞前線\", \"#39144C\",\n          /* default */ \"#000\"\n        ]\n      },\n      \"filter\": [\"in\", \"type\", \"寒冷前線\", \"温暖前線\", \"停滞前線\", \"閉塞前線\"]\n    });\n   \n    this.addSymbols();\n    this.addTyphoons(geojson);\n    \n    this.satellit = new Satellite(this.map);\n  }\n\n  addIsobar(type, width, dash) {\n    const paint = {\n      \"line-color\": \"#ccc\",\n      \"line-opacity\": 0.3,\n      \"line-width\": width\n    };\n    if (dash) paint['line-dasharray'] = dash;\n    this.map.addLayer({\n      \"id\": \"isobar-\" + type,\n      \"type\": \"line\",\n      \"source\": \"weathermap\",\n      \"paint\": paint,\n      \"filter\": [\"all\",\n        [\"==\", \"type\", \"isobar\"],\n        [\"==\", \"isobar\", type]\n      ]\n    });\n  }\n  \n  addSymbols() {\n    this.map.addLayer({\n      \"id\": \"symbol\",\n      \"type\": \"symbol\",\n      \"source\": \"weathermap\",\n      \"layout\": {\n        \"icon-image\": \"center\",\n        \"icon-size\": 0.6,\n        \"icon-allow-overlap\": true\n      },\n      \"paint\": {\n        \"icon-opacity\": 0.7\n      },\n      filter: [\"in\", \"type\", \"低気圧\", \"高気圧\", \"熱帯低気圧\"]\n    });\n    \n    this.map.addLayer({\n      \"id\": \"symbol-pressure\",\n      \"type\": \"symbol\",\n      \"source\": \"weathermap\",\n      \"minzoom\": 3.0,\n      \"layout\": {\n        \"text-field\": \"{pressure}\",\n        \"text-size\": 12,\n        \"text-font\": [\"DIN Pro Regular\"],\n        \"text-offset\": [0, 1.4]\n      },\n      \"paint\": {\n        \"text-color\": \"rgba(255, 255, 255, 0.8)\"\n      },\n      filter: [\"in\", \"type\", \"低気圧\", \"高気圧\", \"熱帯低気圧\"]\n    });\n\n    this.addLabel('低気圧', 'L', '#7A1C1C');\n    this.addLabel('高気圧', 'H', '#1437B1');\n    this.addLabel('熱帯低気圧', 'TD', '#7A1C1C');\n  }\n\n  addLabel(type, label, color) {\n    this.map.addLayer({\n      \"id\": \"symbol-\" + label,\n      \"type\": \"symbol\",\n      \"source\": \"weathermap\",\n      \"layout\": {\n        \"text-field\": label,\n        \"text-size\": 20,\n        \"text-font\": [\"DIN Pro Bold\"],\n        \"text-offset\": [0, -1.0]\n      },\n      \"paint\": {\n        \"text-color\": color,\n        \"text-halo-color\": \"rgba(255, 255, 255, 0.4)\",\n        \"text-halo-width\": 1\n      },\n      filter: [\"==\", \"type\", type]\n    });\n  }\n\n  addTyphoons(geojson) {\n    const typhoon = geojson.features.filter(f => 'typhoonClass' in f.properties)\n      .map(f => {\n        f.properties.pressure = f.properties.center.pressure;\n        f.properties.name = '台' + parseInt(f.properties.name.number.substr(2)) + '号';\n        return f;\n      });\n    this.map.addSource('weathermap-ty', {\n      type: 'geojson',\n      data: { type: 'FeatureCollection', features: typhoon }\n    });\n\n    this.map.addLayer({\n      \"id\": \"symbol-ty-pressure\",\n      \"type\": \"symbol\",\n      \"source\": \"weathermap-ty\",\n      \"minzoom\": 3.0,\n      \"layout\": {\n        \"text-field\": \"{pressure}\",\n        \"text-allow-overlap\": true,\n        \"text-size\": 12,\n        \"text-font\": [\"DIN Pro Regular\"],\n        \"text-offset\": [-1.6, 2.2]\n      },\n      \"paint\": {\n        \"text-color\": \"rgba(255, 255, 255, 0.8)\"\n      },\n    });\n    this.map.addLayer({\n      \"id\": \"symbol-ty\",\n      \"type\": \"symbol\",\n      \"source\": \"weathermap-ty\",\n      \"layout\": {\n        \"icon-image\": \"center\",\n        \"icon-size\": 0.6,\n        \"icon-allow-overlap\": true,\n        \"text-field\": \"{name}\",\n        \"text-size\": 12,\n        \"text-font\": [\"Noto Sans CJK JP Regular\"],\n        \"text-offset\": [-1.5, 1]\n      },\n      \"paint\": {\n        \"icon-opacity\": 0.7,\n        \"text-color\": \"rgba(255, 255, 255, 0.8)\"\n      },\n    });\n  }\n\n\n  hover = (e) => {\n    const features = this.map.queryRenderedFeatures(e.point, { layers: [this.layerId] });\n    this.map.getCanvas().style.cursor = (features.length) ? 'crosshair' : '';\n\n    let html;\n    if (features.length) {\n      const code = features[0].properties.code;\n      html = code;\n    }\n    \n    if (html) {\n      this.popup.setLngLat(e.lngLat)\n        .setHTML(html)\n        .addTo(this.map);\n    } else {\n      this.popup.remove();\n    }\n  }\n}\n","import { Component } from 'react';\n\nimport WeatherMapLayer from './weather-map-layer';\n\nconst url = 'https://storage.googleapis.com/weather-map/weather-map.json';\n\nexport default class Warning extends Component {\n  state = {\n    data: null,\n  };\n\n  componentDidMount() {\n    this.map = this.props.map;\n    this.load();\n  }\n\n  componentWillUnmount() {\n    this.layer.remove();\n  }\n\n  onload(map) {\n    this.map = map;\n    this.addLayer();\n  }\n  \n  load() {\n    const timestamp = new Date().getTime();\n    fetch(url + '?' + timestamp, { mode: 'cors' })\n      .then(res => res.json())\n      .then(data => {\n        console.log(data);\n        this.setState({ data });\n        this.data = data;\n        this.addLayer();\n      });\n  }\n\n  addLayer() {\n    if (!this.map || !this.data) return;\n    this.layer = new WeatherMapLayer(this.map, this.data, this.onSelected);\n  }\n\n  render() {\n    return null;\n  }\n}\n","import React, { Component } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport 'mapbox-gl/dist/mapbox-gl.css'\n\nimport BaseLayer from './BaseLayer';\nimport './Map.css';\n\nimport WeatherMap from './WeatherMap';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw';\n\nconst layers = [\n  {\n    id: 'weather-map',\n    component: WeatherMap,\n    name: '天気図',\n    icon: 'warning sign'\n  },\n];\n\n\nexport default class Map extends Component {\n  state = { layerIndex: 0 };\n\n  componentDidMount() {\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/tattii/ckc0b6ks64uks1io9nljrkbhs',\n      zoom: 4.2,\n      center: [136.6, 35.5],\n      hash: true,\n      logoPosition: 'bottom-right',\n      attributionControl: false\n    });\n\n    this.map.on('load', () => {\n      this.base = new BaseLayer(this.map);\n      this.child.onload(this.map);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"app\">\n        <div ref={el => this.mapContainer = el} id=\"map\" />\n        {this.renderLayer()}\n      </div>\n    )\n  }\n\n  renderLayer() {\n    const props = {\n      map: this.map,\n      ref: ref => this.child = ref,\n    };\n    return React.createElement(layers[this.state.layerIndex].component, props);\n  }\n\n  selectLayer = (index) => {\n    this.setState({ layerIndex: index });\n  }\n}\n","import React, { Component } from 'react';\n\nimport Map from './Map';\n\nclass App extends Component {\n  render() {\n    return (\n      <Map />\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('app'));\n\n"],"sourceRoot":""}